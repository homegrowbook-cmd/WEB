<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Homegrow Book</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <style>
    :root {
      --color-primary: #2e7d32;
      --color-primary-dark: #1b5e20;
      --color-primary-light: #4caf50;
      --color-secondary: #ff9800;
      --color-background: #f5f5f5;
      --color-surface: #ffffff;
      --color-text: #212121;
      --color-text-secondary: #757575;
      --color-border: #e0e0e0;
      --color-danger: #f44336;
      --color-success: #4caf50;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --shadow-md: 0 3px 6px rgba(0,0,0,0.15), 0 2px 4px rgba(0,0,0,0.12);
      --shadow-lg: 0 10px 20px rgba(0,0,0,0.15), 0 3px 6px rgba(0,0,0,0.10);
      --radius: 8px;
      --transition: 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--color-background);
      color: var(--color-text);
      line-height: 1.6;
    }

    /* Admin Header */
    .admin-header {
      background: var(--color-primary);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow-md);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .admin-logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .admin-logo-icon {
      font-size: 1.75rem;
    }

    .admin-nav {
      display: flex;
      gap: 1rem;
    }

    .admin-nav-btn {
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .admin-nav-btn:hover {
      background: rgba(255,255,255,0.2);
    }

    .admin-nav-btn.active {
      background: rgba(255,255,255,0.3);
    }

    /* Main Layout */
    .admin-main {
      display: flex;
      min-height: calc(100vh - 60px);
    }

    /* Sidebar */
    .admin-sidebar {
      width: 250px;
      background: var(--color-surface);
      border-right: 1px solid var(--color-border);
      padding: 1.5rem 0;
      flex-shrink: 0;
    }

    .sidebar-section {
      margin-bottom: 1.5rem;
    }

    .sidebar-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--color-text-secondary);
      padding: 0 1.5rem;
      margin-bottom: 0.5rem;
    }

    .sidebar-menu {
      list-style: none;
    }

    .sidebar-menu-item {
      display: block;
      padding: 0.75rem 1.5rem;
      color: var(--color-text);
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-menu-item:hover {
      background: var(--color-background);
      color: var(--color-primary);
    }

    .sidebar-menu-item.active {
      background: rgba(46, 125, 50, 0.1);
      color: var(--color-primary);
      border-right: 3px solid var(--color-primary);
    }

    .sidebar-menu-item-icon {
      font-size: 1.25rem;
    }

    /* Content Area */
    .admin-content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    .content-header {
      margin-bottom: 2rem;
    }

    .content-header h1 {
      font-size: 1.75rem;
      margin-bottom: 0.5rem;
    }

    .content-header p {
      color: var(--color-text-secondary);
    }

    /* Cards */
    .card {
      background: var(--color-surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      margin-bottom: 1.5rem;
    }

    .card-header {
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--color-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-header h3 {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .card-body {
      padding: 1.5rem;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.625rem 1.25rem;
      border-radius: var(--radius);
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--color-primary-dark);
    }

    .btn-secondary {
      background: var(--color-background);
      color: var(--color-text);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-border);
    }

    .btn-danger {
      background: var(--color-danger);
      color: white;
    }

    .btn-danger:hover {
      background: #d32f2f;
    }

    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.8rem;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--color-text);
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 0.625rem 0.875rem;
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      font-size: 0.9rem;
      transition: var(--transition);
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
    }

    /* Tent/Zelt Management Area */
    .tent-area {
      border: 2px dashed var(--color-border);
      border-radius: var(--radius);
      min-height: 400px;
      position: relative;
      background: linear-gradient(45deg, #f9f9f9 25%, transparent 25%), 
                  linear-gradient(-45deg, #f9f9f9 25%, transparent 25%), 
                  linear-gradient(45deg, transparent 75%, #f9f9f9 75%), 
                  linear-gradient(-45deg, transparent 75%, #f9f9f9 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
      overflow: hidden;
    }

    .tent-item {
      position: absolute;
      background: var(--color-surface);
      border: 2px solid var(--color-primary);
      border-radius: var(--radius);
      padding: 1rem;
      cursor: move;
      user-select: none;
      box-shadow: var(--shadow-md);
      transition: box-shadow 0.2s;
      min-width: 120px;
      text-align: center;
    }

    .tent-item:hover {
      box-shadow: var(--shadow-lg);
    }

    .tent-item.dragging {
      opacity: 0.8;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
    }

    .tent-item-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .tent-item-name {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .tent-item-size {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
    }

    .tent-item-delete {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 24px;
      height: 24px;
      background: var(--color-danger);
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .tent-item:hover .tent-item-delete {
      opacity: 1;
    }

    /* Tent Toolbar */
    .tent-toolbar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .tent-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.75rem 1rem;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      cursor: pointer;
      transition: var(--transition);
      min-width: 80px;
    }

    .tent-btn:hover {
      border-color: var(--color-primary);
      background: rgba(46, 125, 50, 0.05);
    }

    .tent-btn-icon {
      font-size: 1.5rem;
      margin-bottom: 0.25rem;
    }

    .tent-btn-label {
      font-size: 0.75rem;
      color: var(--color-text-secondary);
    }

    /* Products Grid */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
    }

    .product-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      padding: 1rem;
      text-align: center;
      transition: var(--transition);
    }

    .product-card:hover {
      border-color: var(--color-primary);
      box-shadow: var(--shadow-sm);
    }

    .product-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .product-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .product-category {
      font-size: 0.8rem;
      color: var(--color-text-secondary);
    }

    /* Settings */
    .settings-section {
      margin-bottom: 2rem;
    }

    .settings-section h4 {
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--color-border);
    }

    /* Password Settings */
    .password-toggle {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .toggle-switch {
      position: relative;
      width: 48px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--color-border);
      transition: var(--transition);
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: var(--transition);
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--color-primary);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }

    /* Hidden Sections */
    .hidden {
      display: none !important;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .admin-sidebar {
        display: none;
      }

      .admin-content {
        padding: 1rem;
      }

      .tent-toolbar {
        overflow-x: auto;
        flex-wrap: nowrap;
        padding-bottom: 0.5rem;
      }

      .products-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: var(--color-primary);
      color: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification.error {
      background: var(--color-danger);
    }
  </style>
</head>
<body>
  <!-- Admin Header -->
  <header class="admin-header">
    <div class="admin-logo">
      <span class="admin-logo-icon">üå±</span>
      <span>Homegrow Book - Admin</span>
    </div>
    <nav class="admin-nav">
      <button class="admin-nav-btn" onclick="window.location.href='index.html'">‚Üê Zur√ºck zur Website</button>
      <button class="admin-nav-btn" id="logoutBtn">Abmelden</button>
    </nav>
  </header>

  <!-- Main Layout -->
  <div class="admin-main">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <div class="sidebar-section">
        <h4 class="sidebar-title">Dashboard</h4>
        <ul class="sidebar-menu">
          <li class="sidebar-menu-item active" data-section="dashboard">
            <span class="sidebar-menu-item-icon">üìä</span>
            <span>√úbersicht</span>
          </li>
          <li class="sidebar-menu-item" data-section="tents">
            <span class="sidebar-menu-item-icon">üèïÔ∏è</span>
            <span>Zelte verwalten</span>
          </li>
          <li class="sidebar-menu-item" data-section="products">
            <span class="sidebar-menu-item-icon">üß™</span>
            <span>Produkte</span>
          </li>
        </ul>
      </div>
      <div class="sidebar-section">
        <h4 class="sidebar-title">System</h4>
        <ul class="sidebar-menu">
          <li class="sidebar-menu-item" data-section="settings">
            <span class="sidebar-menu-item-icon">‚öôÔ∏è</span>
            <span>Einstellungen</span>
          </li>
        </ul>
      </div>
    </aside>

    <!-- Content Area -->
    <main class="admin-content">
      <!-- Dashboard Section -->
      <section id="section-dashboard" class="admin-section">
        <div class="content-header">
          <h1>Dashboard √úbersicht</h1>
          <p>Willkommen im Homegrow Book Admin Panel</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>üå± Schnellzugriff</h3>
          </div>
          <div class="card-body">
            <div class="products-grid">
              <div class="product-card" onclick="showSection('tents')">
                <div class="product-icon">üèïÔ∏è</div>
                <div class="product-name">Zelte verwalten</div>
                <div class="product-category">Zelte hinzuf√ºgen und positionieren</div>
              </div>
              <div class="product-card" onclick="showSection('products')">
                <div class="product-icon">üß™</div>
                <div class="product-name">Produkte</div>
                <div class="product-category">Verf√ºgbare Produkte ansehen</div>
              </div>
              <div class="product-card" onclick="showSection('settings')">
                <div class="product-icon">‚öôÔ∏è</div>
                <div class="product-name">Einstellungen</div>
                <div class="product-category">System konfigurieren</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tents/Zelte Section -->
      <section id="section-tents" class="admin-section hidden">
        <div class="content-header">
          <h1>üèïÔ∏è Zelte verwalten</h1>
          <p>F√ºgen Sie Zelte hinzu und positionieren Sie diese durch Drag & Drop</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Zelt hinzuf√ºgen</h3>
          </div>
          <div class="card-body">
            <div class="tent-toolbar">
              <button class="tent-btn" onclick="addTent('small')">
                <span class="tent-btn-icon">üèïÔ∏è</span>
                <span class="tent-btn-label">Klein (60x60)</span>
              </button>
              <button class="tent-btn" onclick="addTent('medium')">
                <span class="tent-btn-icon">üèïÔ∏è</span>
                <span class="tent-btn-label">Mittel (80x80)</span>
              </button>
              <button class="tent-btn" onclick="addTent('large')">
                <span class="tent-btn-icon">üèïÔ∏è</span>
                <span class="tent-btn-label">Gro√ü (100x100)</span>
              </button>
              <button class="tent-btn" onclick="addTent('xlarge')">
                <span class="tent-btn-icon">üèïÔ∏è</span>
                <span class="tent-btn-label">XL (120x120)</span>
              </button>
              <button class="tent-btn" onclick="addTent('custom')">
                <span class="tent-btn-icon">‚ûï</span>
                <span class="tent-btn-label">Eigene Gr√∂√üe</span>
              </button>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Zelt-Layout</h3>
            <button class="btn btn-secondary btn-sm" onclick="saveTentLayout()">üíæ Layout speichern</button>
          </div>
          <div class="card-body">
            <div class="tent-area" id="tentArea">
              <!-- Tents will be added here dynamically -->
            </div>
          </div>
        </div>
      </section>

      <!-- Products Section -->
      <section id="section-products" class="admin-section hidden">
        <div class="content-header">
          <h1>üß™ Produkte</h1>
          <p>Verf√ºgbare Produkte f√ºr Ihre Pflanzen</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Verf√ºgbare Produkte</h3>
          </div>
          <div class="card-body">
            <div class="products-grid" id="productsGrid">
              <!-- Products will be loaded here -->
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="section-settings" class="admin-section hidden">
        <div class="content-header">
          <h1>‚öôÔ∏è Einstellungen</h1>
          <p>Systemkonfiguration und Sicherheit</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>üîê Passwortschutz</h3>
          </div>
          <div class="card-body">
            <div class="settings-section">
              <div class="password-toggle">
                <label class="toggle-switch">
                  <input type="checkbox" id="passwordEnabled" onchange="togglePasswordProtection()">
                  <span class="toggle-slider"></span>
                </label>
                <span>Passwortschutz aktivieren (optional)</span>
              </div>
              
              <div id="passwordSettings" class="hidden">
                <div class="form-group">
                  <label class="form-label">Neues Passwort setzen</label>
                  <input type="password" class="form-input" id="newPassword" placeholder="Passwort eingeben">
                </div>
                <div class="form-group">
                  <label class="form-label">Passwort best√§tigen</label>
                  <input type="password" class="form-input" id="confirmPassword" placeholder="Passwort best√§tigen">
                </div>
                <button class="btn btn-primary" onclick="savePassword()">Passwort speichern</button>
              </div>
              
              <p style="margin-top: 1rem; font-size: 0.85rem; color: var(--color-text-secondary);">
                Hinweis: Der Zugang zum Admin Panel erfolgt standardm√§√üig durch 3x Klicken auf das Logo. 
                Sie k√∂nnen optional ein Passwort setzen, m√ºssen dies aber nicht.
              </p>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>üì± Allgemeine Einstellungen</h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label class="form-label">App-Name</label>
              <input type="text" class="form-input" id="appName" value="Homegrow Book">
            </div>
            <div class="form-group">
              <label class="form-label">Sprache</label>
              <select class="form-select" id="appLanguage">
                <option value="de" selected>Deutsch</option>
                <option value="en">English</option>
              </select>
            </div>
            <button class="btn btn-primary" onclick="saveSettings()">Einstellungen speichern</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification"></div>

  <script>
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initSidebar();
      loadProducts();
      loadTentLayout();
      loadSettings();
    });

    // Sidebar Navigation
    function initSidebar() {
      const menuItems = document.querySelectorAll('.sidebar-menu-item');
      menuItems.forEach(item => {
        item.addEventListener('click', function() {
          const section = this.dataset.section;
          showSection(section);
        });
      });
    }

    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.admin-section').forEach(section => {
        section.classList.add('hidden');
      });
      
      // Show selected section
      const targetSection = document.getElementById('section-' + sectionId);
      if (targetSection) {
        targetSection.classList.remove('hidden');
      }
      
      // Update sidebar active state
      document.querySelectorAll('.sidebar-menu-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.section === sectionId) {
          item.classList.add('active');
        }
      });
    }

    // Products - Without the removed products
    const availableProducts = [
      { icon: 'üå±', name: 'Grow D√ºnger', category: 'N√§hrstoffe' },
      { icon: 'üå∏', name: 'Bloom D√ºnger', category: 'N√§hrstoffe' },
      { icon: 'üíß', name: 'pH-Minus', category: 'pH-Kontrolle' },
      { icon: 'üíß', name: 'pH-Plus', category: 'pH-Kontrolle' },
      { icon: 'üî¨', name: 'EC-Meter', category: 'Messger√§te' },
      { icon: 'üî¨', name: 'pH-Meter', category: 'Messger√§te' },
      { icon: 'üí°', name: 'LED Lampe', category: 'Beleuchtung' },
      { icon: 'üå°Ô∏è', name: 'Thermometer', category: 'Messger√§te' },
      { icon: 'üí®', name: 'Ventilator', category: 'Bel√ºftung' },
      { icon: 'üåÄ', name: 'Abluft-System', category: 'Bel√ºftung' },
      { icon: 'ü™¥', name: 'T√∂pfe', category: 'Beh√§lter' },
      { icon: 'üåç', name: 'Erde', category: 'Substrate' },
      { icon: 'ü™®', name: 'Perlite', category: 'Substrate' },
      { icon: '‚è∞', name: 'Zeitschaltuhr', category: 'Automatisierung' },
      { icon: 'üí¶', name: 'Bew√§sserungssystem', category: 'Automatisierung' }
      // Removed products:
      // - Rootstimulator
      // - COCO A
      // - COCO B
      // - Spraymix
      // - Generator
      // - Cal-Mag
    ];

    function loadProducts() {
      const grid = document.getElementById('productsGrid');
      grid.innerHTML = availableProducts.map(product => `
        <div class="product-card">
          <div class="product-icon">${product.icon}</div>
          <div class="product-name">${product.name}</div>
          <div class="product-category">${product.category}</div>
        </div>
      `).join('');
    }

    // Tent Management
    let tents = [];
    let tentCounter = 0;
    let draggedTent = null;
    let dragOffset = { x: 0, y: 0 };

    const tentSizes = {
      small: { width: 60, height: 60, label: 'Klein' },
      medium: { width: 80, height: 80, label: 'Mittel' },
      large: { width: 100, height: 100, label: 'Gro√ü' },
      xlarge: { width: 120, height: 120, label: 'XL' }
    };

    function addTent(size) {
      if (size === 'custom') {
        const width = prompt('Breite in cm:', '90');
        const height = prompt('Tiefe in cm:', '90');
        if (width && height) {
          createTent({
            id: ++tentCounter,
            width: parseInt(width),
            height: parseInt(height),
            label: 'Custom',
            x: 20,
            y: 20
          });
        }
      } else {
        const sizeConfig = tentSizes[size];
        createTent({
          id: ++tentCounter,
          width: sizeConfig.width,
          height: sizeConfig.height,
          label: sizeConfig.label,
          x: 20 + (tentCounter * 20) % 200,
          y: 20 + Math.floor(tentCounter / 5) * 100
        });
      }
    }

    function createTent(tent) {
      tents.push(tent);
      renderTents();
      showNotification('Zelt hinzugef√ºgt!');
    }

    function renderTents() {
      const area = document.getElementById('tentArea');
      area.innerHTML = tents.map(tent => `
        <div class="tent-item" 
             data-id="${tent.id}" 
             style="left: ${tent.x}px; top: ${tent.y}px;"
             onmousedown="startDrag(event, ${tent.id})"
             ontouchstart="startDragTouch(event, ${tent.id})">
          <button class="tent-item-delete" onclick="deleteTent(event, ${tent.id})">√ó</button>
          <div class="tent-item-icon">üèïÔ∏è</div>
          <div class="tent-item-name">Zelt ${tent.id}</div>
          <div class="tent-item-size">${tent.width}x${tent.height} cm</div>
        </div>
      `).join('');
    }

    function startDrag(e, id) {
      e.preventDefault();
      const tent = document.querySelector(`.tent-item[data-id="${id}"]`);
      draggedTent = { id, element: tent };
      tent.classList.add('dragging');
      
      const rect = tent.getBoundingClientRect();
      dragOffset = {
        x: e.clientX - rect.left,
        y: e.clientY - rect.top
      };

      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);
    }

    function startDragTouch(e, id) {
      const touch = e.touches[0];
      const tent = document.querySelector(`.tent-item[data-id="${id}"]`);
      draggedTent = { id, element: tent };
      tent.classList.add('dragging');
      
      const rect = tent.getBoundingClientRect();
      dragOffset = {
        x: touch.clientX - rect.left,
        y: touch.clientY - rect.top
      };

      document.addEventListener('touchmove', onDragTouch);
      document.addEventListener('touchend', stopDragTouch);
    }

    function onDrag(e) {
      if (!draggedTent) return;
      
      const area = document.getElementById('tentArea');
      const areaRect = area.getBoundingClientRect();
      
      let x = e.clientX - areaRect.left - dragOffset.x;
      let y = e.clientY - areaRect.top - dragOffset.y;
      
      // Constrain to area bounds
      x = Math.max(0, Math.min(x, areaRect.width - 120));
      y = Math.max(0, Math.min(y, areaRect.height - 100));
      
      draggedTent.element.style.left = x + 'px';
      draggedTent.element.style.top = y + 'px';
    }

    function onDragTouch(e) {
      e.preventDefault();
      const touch = e.touches[0];
      
      const area = document.getElementById('tentArea');
      const areaRect = area.getBoundingClientRect();
      
      let x = touch.clientX - areaRect.left - dragOffset.x;
      let y = touch.clientY - areaRect.top - dragOffset.y;
      
      x = Math.max(0, Math.min(x, areaRect.width - 120));
      y = Math.max(0, Math.min(y, areaRect.height - 100));
      
      draggedTent.element.style.left = x + 'px';
      draggedTent.element.style.top = y + 'px';
    }

    function stopDrag(e) {
      if (!draggedTent) return;
      
      const tent = tents.find(t => t.id === draggedTent.id);
      if (tent) {
        tent.x = parseInt(draggedTent.element.style.left);
        tent.y = parseInt(draggedTent.element.style.top);
      }
      
      draggedTent.element.classList.remove('dragging');
      draggedTent = null;
      
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', stopDrag);
    }

    function stopDragTouch(e) {
      if (!draggedTent) return;
      
      const tent = tents.find(t => t.id === draggedTent.id);
      if (tent) {
        tent.x = parseInt(draggedTent.element.style.left);
        tent.y = parseInt(draggedTent.element.style.top);
      }
      
      draggedTent.element.classList.remove('dragging');
      draggedTent = null;
      
      document.removeEventListener('touchmove', onDragTouch);
      document.removeEventListener('touchend', stopDragTouch);
    }

    function deleteTent(e, id) {
      e.stopPropagation();
      if (confirm('Zelt wirklich l√∂schen?')) {
        tents = tents.filter(t => t.id !== id);
        renderTents();
        showNotification('Zelt gel√∂scht');
      }
    }

    function saveTentLayout() {
      localStorage.setItem('homegrow_tents', JSON.stringify(tents));
      localStorage.setItem('homegrow_tent_counter', tentCounter);
      showNotification('Layout gespeichert!');
    }

    function loadTentLayout() {
      const saved = localStorage.getItem('homegrow_tents');
      const savedCounter = localStorage.getItem('homegrow_tent_counter');
      if (saved) {
        tents = JSON.parse(saved);
        tentCounter = parseInt(savedCounter) || tents.length;
        renderTents();
      }
    }

    // Settings
    function togglePasswordProtection() {
      const enabled = document.getElementById('passwordEnabled').checked;
      const settings = document.getElementById('passwordSettings');
      settings.classList.toggle('hidden', !enabled);
      
      if (!enabled) {
        localStorage.removeItem('homegrow_password');
        showNotification('Passwortschutz deaktiviert');
      }
    }

    function savePassword() {
      const newPass = document.getElementById('newPassword').value;
      const confirmPass = document.getElementById('confirmPassword').value;
      
      if (!newPass) {
        showNotification('Bitte Passwort eingeben', true);
        return;
      }
      
      if (newPass !== confirmPass) {
        showNotification('Passw√∂rter stimmen nicht √ºberein', true);
        return;
      }
      
      // Simple hash for demo (in production use proper hashing)
      localStorage.setItem('homegrow_password', btoa(newPass));
      showNotification('Passwort gespeichert!');
      
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
    }

    function saveSettings() {
      const settings = {
        appName: document.getElementById('appName').value,
        language: document.getElementById('appLanguage').value
      };
      localStorage.setItem('homegrow_settings', JSON.stringify(settings));
      showNotification('Einstellungen gespeichert!');
    }

    function loadSettings() {
      const saved = localStorage.getItem('homegrow_settings');
      if (saved) {
        const settings = JSON.parse(saved);
        document.getElementById('appName').value = settings.appName || 'Homegrow Book';
        document.getElementById('appLanguage').value = settings.language || 'de';
      }
      
      const hasPassword = localStorage.getItem('homegrow_password');
      document.getElementById('passwordEnabled').checked = !!hasPassword;
      if (hasPassword) {
        document.getElementById('passwordSettings').classList.remove('hidden');
      }
    }

    // Notification
    function showNotification(message, isError = false) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.toggle('error', isError);
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', function() {
      sessionStorage.removeItem('homegrow_admin_access');
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
